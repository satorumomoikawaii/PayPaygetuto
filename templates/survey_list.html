<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä¸€è¦§</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    /* ãƒãƒŠãƒ¼é€šçŸ¥ã‚¹ã‚¿ã‚¤ãƒ«ï¼šã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã®é€šçŸ¥é¢¨ãƒ»ãµã‚ã£ã¨ä¸Šã‹ã‚‰é™ã‚Šã‚‹ */
    .notification-banner {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 220px;
      max-width: 92vw;
      position: fixed;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(90deg, #38c6ff 0%, #2f80ed 100%);
      color: #fff;
      font-size: 1.06em;
      font-weight: 600;
      padding: 16px 28px;
      border-radius: 16px;
      box-shadow: 0 8px 24px 0 rgba(47,128,237,0.12);
      z-index: 10000;
      opacity: 0.97;
      transition: top 0.42s cubic-bezier(.4,2,.4,1), opacity 0.35s;
      pointer-events: none;
      letter-spacing: 0.03em;
    }
    .notification-banner.show {
      top: 24px;
      opacity: 1;
      pointer-events: auto;
    }
    .notification-banner__icon {
      margin-right: 12px;
      font-size: 1.32em;
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>
  <!-- ã‚¹ãƒãƒ›ãƒãƒŠãƒ¼é¢¨é€šçŸ¥ -->
  <div class="notification-banner" id="notification-banner">
    <span class="notification-banner__icon">ğŸ‰</span>
    <span class="notification-banner__msg"></span>
  </div>
  <div class="user-header-bar">
    <a href="{{ url_for('mypage') }}" class="user-header-back" title="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹" aria-label="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹">ï¼œ</a>
    <div class="user-header-title">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä¸€è¦§</div>
  </div>
  <div class="main-container survey-main-container">
    <h2 class="survey-title">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä¸€è¦§</h2>
    <div class="survey-list">
      <div class="survey-question-card" id="open-survey-modal" tabindex="0" role="button" aria-label="ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚’é–‹ã">
        <div class="survey-question-category-row">
          <span class="survey-question-category">ãƒ¦ãƒ¼ã‚¶ãƒ¼èª¿æŸ»</span>
        </div>
        <div class="survey-question-title-row">
          <span class="survey-question-title" title="ã‚‚ã—å¤§é‡ã«ãŠé‡‘ãŒè²°ãˆãŸã‚‰ä½•ã«ä½¿ã„ã¾ã™ã‹ï¼Ÿ">
            ã‚‚ã—å¤§é‡ã«ãŠé‡‘ãŒè²°ãˆãŸã‚‰ä½•ã«ä½¿ã„ã¾ã™ã‹ï¼Ÿ
          </span>
          <span class="survey-question-arrow">ï¼</span>
        </div>
        <div class="survey-question-reward">
          <span class="reward-icon">
            <svg width="18" height="18" viewBox="0 0 18 18">
              <circle cx="9" cy="9" r="8" fill="#fff3df" stroke="#ffb300" stroke-width="2"/>
              <circle cx="9" cy="9" r="5.5" fill="#ffe082" stroke="#ffb300" stroke-width="1.2"/>
              <text x="9" y="13.2" text-anchor="middle" font-size="9" font-weight="bold" fill="#ffb300" font-family="Arial">Â¥</text>
            </svg>
          </span>
          <span class="reward-label">+10å††</span>
        </div>
      </div>
    </div>
  </div>

  <!-- â–¼ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ»ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ  â–¼ -->
  <div class="survey-modal" id="survey-modal" style="display:none;">
    <div class="survey-modal-content" id="survey-modal-content">
      <button class="survey-modal-close" id="close-survey-modal" aria-label="é–‰ã˜ã‚‹">&times;</button>
      <div class="survey-question-category-row" style="margin-top:10px;">
        <span class="survey-question-category">ãƒ¦ãƒ¼ã‚¶ãƒ¼èª¿æŸ»</span>
      </div>
      <div class="survey-question-title-row" style="margin-bottom:10px;">
        <span class="survey-question-title" style="font-size:1.13em;" title="ã‚‚ã—å¤§é‡ã«ãŠé‡‘ãŒè²°ãˆãŸã‚‰ä½•ã«ä½¿ã„ã¾ã™ã‹ï¼Ÿ">
          ã‚‚ã—å¤§é‡ã«ãŠé‡‘ãŒè²°ãˆãŸã‚‰ä½•ã«ä½¿ã„ã¾ã™ã‹ï¼Ÿ
        </span>
      </div>
      <div class="survey-multi-note">â€»è¤‡æ•°é¸æŠãŒå¯èƒ½ã§ã™</div>
      <form class="survey-form">
        <fieldset class="survey-fieldset">
          <legend class="survey-legend">ä½¿ã„é“ã‚’é¸ã‚“ã§ãã ã•ã„</legend>
          <label class="survey-option">
            <input type="checkbox" name="money_usage" value="æ—…è¡Œãƒ»ãƒ¬ã‚¸ãƒ£ãƒ¼">
            æ—…è¡Œãƒ»ãƒ¬ã‚¸ãƒ£ãƒ¼
          </label>
          <label class="survey-option">
            <input type="checkbox" name="money_usage" value="è²¯é‡‘ãƒ»è³‡ç”£é‹ç”¨">
            è²¯é‡‘ãƒ»è³‡ç”£é‹ç”¨
          </label>
          <label class="survey-option">
            <input type="checkbox" name="money_usage" value="å®¶ã‚„è»Šãªã©é«˜é¡ãªè²·ã„ç‰©">
            å®¶ã‚„è»Šãªã©é«˜é¡ãªè²·ã„ç‰©
          </label>
          <label class="survey-option">
            <input type="checkbox" name="money_usage" value="è¶£å‘³ãƒ»è‡ªå·±æŠ•è³‡">
            è¶£å‘³ãƒ»è‡ªå·±æŠ•è³‡
          </label>
          <label class="survey-option">
            <input type="checkbox" name="money_usage" value="å®¶æ—ã‚„å‹äººã¸ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ">
            å®¶æ—ã‚„å‹äººã¸ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ
          </label>
          <label class="survey-option">
            <input type="checkbox" name="money_usage" value="å¯„ä»˜ãƒ»ç¤¾ä¼šè²¢çŒ®">
            å¯„ä»˜ãƒ»ç¤¾ä¼šè²¢çŒ®
          </label>
          <label class="survey-option survey-option-other">
            <input type="checkbox" name="money_usage" value="ãã®ä»–" id="other-checkbox">
            ãã®ä»–
            <input type="text" name="other_usage" class="survey-other-input" placeholder="å…·ä½“çš„ã«å…¥åŠ›ã—ã¦ãã ã•ã„" style="display:none;">
          </label>
        </fieldset>
        <div class="form-error" style="display:none; color: red; margin-bottom:8px;"></div>
        <button type="submit" class="survey-submit-btn">å›ç­”ã™ã‚‹</button>
      </form>
    </div>
  </div>
  <!-- â–² ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã“ã“ã¾ã§ â–² -->

  <script>
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‹é–‰ï¼‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    document.getElementById('open-survey-modal').addEventListener('click', function() {
      const modal = document.getElementById('survey-modal');
      const modalContent = document.getElementById('survey-modal-content');
      modal.style.display = 'flex';
      modalContent.classList.remove('show-anim');
      void modalContent.offsetWidth;
      modalContent.classList.add('show-anim');
    });
    document.getElementById('close-survey-modal').addEventListener('click', function() {
      document.getElementById('survey-modal').style.display = 'none';
    });

    // ã€Œãã®ä»–ã€ãƒã‚§ãƒƒã‚¯æ™‚ã«ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹è¡¨ç¤º
    document.addEventListener('DOMContentLoaded', function() {
      const otherCheckbox = document.getElementById('other-checkbox');
      const otherInput = document.querySelector('.survey-other-input');
      if (otherCheckbox && otherInput) {
        otherCheckbox.addEventListener('change', function() {
          if (this.checked) {
            otherInput.style.display = 'inline-block';
            otherInput.focus();
          } else {
            otherInput.style.display = 'none';
            otherInput.value = '';
          }
        });
      }

      // ã€Œãã®ä»–ã€ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã§ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ»ç¢ºå®šæ™‚ã«5æ–‡å­—æœªæº€ãªã‚‰è­¦å‘Š
      if (otherInput) {
        otherInput.addEventListener('keydown', function(e) {
          if (
            (e.key === 'Enter' || e.keyCode === 13) &&
            otherCheckbox.checked
          ) {
            if (!otherInput.value || otherInput.value.trim().length < 5) {
              e.preventDefault();
              showOtherInputError();
            }
          }
        });
        // ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã€Œç¢ºå®šã€ãƒœã‚¿ãƒ³ï¼ˆinputã‚¤ãƒ™ãƒ³ãƒˆã§æ¤œå‡ºï¼‰
        otherInput.addEventListener('change', function(e) {
          if (otherCheckbox.checked && (!otherInput.value || otherInput.value.trim().length < 5)) {
            showOtherInputError();
          }
        });
      }

      // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé–¢æ•°
      function showOtherInputError() {
        const errorDiv = document.querySelector('.form-error');
        errorDiv.textContent = 'ã€Œãã®ä»–ã€ã®å†…å®¹ã¯æœ€ä½5æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
        errorDiv.style.display = 'block';
        otherInput.focus();
      }
    });

    // â–¼â–¼ è¿½åŠ ï¼šã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæœªå…¥åŠ›æ™‚ã‚¨ãƒ©ãƒ¼è¡¨ç¤º â–¼â–¼
    document.querySelector('.survey-form').addEventListener('submit', function(e) {
      const checkboxes = document.querySelectorAll('input[name="money_usage"]:checked');
      const otherCheckbox = document.getElementById('other-checkbox');
      const otherInput = document.querySelector('.survey-other-input');
      const errorDiv = document.querySelector('.form-error');
      let hasError = false;

      if (
        checkboxes.length === 0 ||
        (otherCheckbox.checked && (!otherInput.value || !otherInput.value.trim()))
      ) {
        hasError = true;
        errorDiv.textContent = 'æœ€ä½1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ã€‚ã€Œãã®ä»–ã€ã®å ´åˆã¯å†…å®¹ã‚‚å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return;
      }
      // ã€Œãã®ä»–ã€ã‚’é¸æŠã—ã¦ã„ã‚‹å ´åˆã¯5æ–‡å­—ä»¥ä¸Šå¿…é ˆ
      if (
        otherCheckbox.checked &&
        otherInput.value &&
        otherInput.value.trim().length < 5
      ) {
        errorDiv.textContent = 'ã€Œãã®ä»–ã€ã®å†…å®¹ã¯æœ€ä½5æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
        errorDiv.style.display = 'block';
        e.preventDefault();
        otherInput.focus();
        return;
      }

      errorDiv.style.display = 'none';

      // â–¼â–¼ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆé€ä¿¡æ™‚ã€é€šçŸ¥ãƒãƒŠãƒ¼è¡¨ç¤ºï¼‹2ç§’å¾Œã«ä¸€è¦§ã¸æˆ»ã‚‹ â–¼â–¼
      e.preventDefault(); // ãƒ†ã‚¹ãƒˆç”¨ï¼šæœ¬ç•ªã¯ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆé€ä¿¡å‡¦ç†å¾Œã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
      showNotificationBanner("ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«å›ç­”ã—ã¾ã—ãŸï¼");
      setTimeout(() => {
        // ä¸€è¦§ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆä»Šã„ã‚‹ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ãªã‚‰location.reload()ã§ã‚‚OKï¼‰
        window.location.href = window.location.pathname; // ãã®ã¾ã¾ä¸€è¦§ã«æˆ»ã™
      }, 2000);
    });
    // â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²

    // â–¼â–¼ é€šçŸ¥ãƒãƒŠãƒ¼è¡¨ç¤ºé–¢æ•° â–¼â–¼
    function showNotificationBanner(message) {
      const banner = document.getElementById('notification-banner');
      const barMsg = banner.querySelector('.notification-banner__msg');
      barMsg.textContent = message;
      banner.classList.add('show');
      setTimeout(() => {
        banner.classList.remove('show');
      }, 1800); // 2ç§’ä»¥å†…ã§æ¶ˆã—ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    }
    // â–²â–² é€šçŸ¥ãƒãƒŠãƒ¼ã“ã“ã¾ã§ â–²â–²

  </script>
</body>
</html>